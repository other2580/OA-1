<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="oa.dao.MessageReceptionDao">
	<!-- 添加邮件接收记录 -->
	<insert id="add" parameterType="MessageReception" keyProperty="id" useGeneratedKeys="true">
		INSERT INTO MessageReception(MessageId, ReceiverId, IsRead, STATUS) 
			VALUES(#{message.id}, #{receiver.id}, #{isRead}, #{status})
	</insert>
	<!-- 删除邮件接收记录 -->
	<delete id="delete" parameterType="int">
		DELETE FROM MessageReception WHERE id = #{id}
	</delete>
	
	<resultMap type="MessageReception" id="MessageReceptionResultMap">
		<id column="id" property="id"/>
		<result column="isRead" property="isRead"/>
		<result column="status" property="status"/>
		
		<!-- 邮件主体 -->
		<association property="message" column="messageId" 
			javaType="Message" select="oa.dao.MessageDao.fetchMessageById" />
		<!-- 邮件接收者 -->
		<association property="receiver" column="receiverId" 
			javaType="Employee" select="oa.dao.EmployeeDao.fetchEmployeeById" />
	</resultMap>
	
	<!-- 根据Id查找记录  -->
	<select id="fetchMessageReceptionById" resultMap="MessageReceptionResultMap" parameterType="int">
		SELECT * FROM MessageReception WHERE id = #{id}
	</select>
</mapper>